//
//  TooImportantToTossFlowState.cpp
//  ProjectRetro
//
//  Created by Alex Koukoulas on 08/08/2019.
//

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

#include "ItemMenuFlowState.h"
#include "TooImportantToTossFlowState.h"
#include "../components/GuiStateSingletonComponent.h"
#include "../utils/TextboxUtils.h"

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

const float TooImportantToTossFlowState::TOO_IMPORTANT_TO_TOSS_CHATBOX_Z = -0.3f;

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

TooImportantToTossFlowState::TooImportantToTossFlowState(ecs::World& world)
    : BaseFlowState(world)
{
    const auto chatboxEntityId = CreateChatbox(mWorld, glm::vec3(CHATBOX_POSITION.x, CHATBOX_POSITION.y, TOO_IMPORTANT_TO_TOSS_CHATBOX_Z));
    QueueDialogForChatbox(chatboxEntityId, "That's too impor-#tant to toss!#+END", mWorld);    
}

void TooImportantToTossFlowState::VUpdate(const float)
{    
    const auto& guiStateComponent = mWorld.GetSingletonComponent<GuiStateSingletonComponent>();

    if (guiStateComponent.mActiveTextboxesStack.size() == 3)
    {                
        // Destroy Use/Toss Textbox
        DestroyActiveTextbox(mWorld);
        
        CompleteAndTransitionTo<ItemMenuFlowState>();
    }
}

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
