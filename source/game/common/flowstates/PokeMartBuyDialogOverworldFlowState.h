//
//  PokeMartBuyDialogOverworldFlowState.h
//  ProjectRetro
//
//  Created by Alex Koukoulas on 27/09/2019.
//

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

#ifndef PokeMartBuyDialogOverworldFlowState_h
#define PokeMartBuyDialogOverworldFlowState_h

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

#include "BaseFlowState.h"
#include "../../common/utils/StringUtils.h"
#include "../../ECS.h"

#include <string>

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

class PokeMartBuyDialogOverworldFlowState final: public BaseFlowState
{
public:
    PokeMartBuyDialogOverworldFlowState(ecs::World&);
    
    void VUpdate(const float dt) override;
    
private:
    void UpdateIntroFlow();
    void UpdateItemMenu(const float dt);
    void UpdateItemQuantityMenu(const float dt);
    void UpdateCancellingFlow();
    void CancelDialog();
    void RedrawItemMenu();
    void SaveLastFramesCursorRow();    
    void DisplayItemsInMenuForCurrentOffset() const;
    
    static const std::string TEXTBOX_CLICK_SFX_NAME;
    static const float OVERLAID_CHATBOX_Z;

    enum class BuyDialogState
    {
        INTRO, ITEM_MENU, ITEM_QUANTITY, CANCELLING
    };
    
    ecs::EntityId mItemQuantityTextboxEntityId;
    StringId mSelectedItemName;
    BuyDialogState mBuyDialogState;
    int mSelectedQuantity;
    
};

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

#endif /* PokeMartBuyDialogOverworldFlowState_h */
